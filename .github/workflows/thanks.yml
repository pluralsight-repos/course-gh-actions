name: thanks

on:

  issues:
    types: [opened]
  workflow_dispatch: # manual trigger

jobs:
  thanks:
    runs-on: ubuntu-latest
    permissions:
      issues: write
    steps:
      - uses: actions/github-script@v7
        id: issue_script
        with:
            github-token: ${{ secrets.GITHUB_TOKEN }}
            script: |
              const issue_number = context.issue.number || 2;
              console.log(`issue_number: ${issue_number}`);

              const owner = context.repo.owner;
              const repo = context.repo.repo;
              console.log(`owner: ${owner}`);
              console.log(`repo: ${repo}`);

              // look up the issue
              const issue = await github.rest.issues.get({
                owner,
                repo,
                issue_number
              });
              console.log(`issue: ${issue}`);

              // create a comment thanking contributors
              const comment = await github.issues.createComment({
                owner,
                repo,
                issue_number,
                body: "Thank you for your contribution!"
              });
              console.log(`comment id: ${comment.data.id}`);
              console.log(comment.data)

              // auto label
              await github.issues.addLabels({
                owner,
                repo,
                issue_number,
                labels: ["todo-review"]
              });

              // make comment id available to subsequent steps
                return comment.data.id;
    
      - run: echo 'comment id=${{ steps.issue_script.outputs.result }}'

